<style>
th, td {
    padding:2px 5px!important;
}
</style>

# Domotizzazione dell'aula

## Indice

<div class="clearfix index">
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;"><h5>Capitolo</h5></div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;"><h5>Pagina</h5></div>
    <div style="margin-top:5px;widht:100%;"> </div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">1 Introduzione</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">3</div>
        <div style="margin-top:5px;widht:100%;"> </div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.1 Informazione sul progetto</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">3</div>
        <div style="margin-top:5px;widht:100%;"> </div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.2 Abstrat</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">3</div>
        <div style="margin-top:5px;widht:100%;"> </div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.3 Scopo</div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">4</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.4 Analisi del dominio</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">4</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.5 Analisi e specifica dei requisiti</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">4</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;1.6 Pianificazione
        </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">7</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">&emsp;1.7 Analisi dei mezzi</div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">6</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;1.7.1Software
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">6</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;1.7.2Hardware
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">6</div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        2 Progettazione
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">8</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;2.1 Architettura del progetto
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">5</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.2 Design dell'interfaccia di login
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">8</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.3 Design della dashboard del sito web
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">10</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.4 Architettura Database
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">11</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.6 Architettura Arduino Yun
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">11</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.7 Arduino Connection Controller Client
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">11</div>
            <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
                &emsp;&emsp;2.8 Arduino Connection Controller Server
            </div>
            <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">11</div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        3 Implementazione
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">12</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;3.1 Login del sito web
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">14</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;3.2 Dashboard del sito weblogSensor
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">15</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;3.3 Database
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">16</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;3.4 Lightweight Directory Access Protocol
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">33</div><div class="page-break"></div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        4 Test
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">35</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;4.1 Protocollo di test
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">35</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;4.2 Risultati test
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">42</div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        Consuntivo
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">43</div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        5 Conclusioni
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">44</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;5.1 Sviluppi futuri
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">44</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;5.2 Considerazioni personali
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">44</div>
        <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
            &emsp;5.3 Sitografia
        </div>
        <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">44</div>
    <div class="capitle" style="width:80%;float:left;border-bottom:1px dotted #DDDDDD;">
        6 Allegati
    </div>
    <div class="page" style="text-align:right;width:20%;float:left;border-bottom:1px dotted #DDDDDD;">44</div>
</div>

## 1 Introduzione

### 1.1 Informazioni sul progetto

Questo progetto è stato assegnato dal docente Francesco Mussi il 13.02.2019 agli allievi del terzo anno della scuola arti e mestieri Trevano. Mattia Ruberto, Giulio Bosco e Paolo Gübeli sono i membri del gruppo che si occupano del progetto. La scadenza del progetto è fissata per il 17.05.2019.

### 1.2 Abstract

This project started from the fact that the lighting switches of the school of arts and crafts of Trevano are placed in the classroom in clumsy and uncomfortable places so we decided to implement an application that would allow you to manage lights, curtains and beamer through a website that allows you to adjust the various components of the classroom. In short, it is a domotization of the classrooms that in this way can be controlled remotely.

### 1.3 Scopo

Lo scopo del progetto è quello di domotizzare le aule della scuola arti e mestieri Trevano. Per domotizzazione delle aule si intende la possibilità di poter gestire le luci, il beamer e le tende delle aule tramite un sito web in cui vengono rappresentate le aule con tutti i valori modificabili. In questo sito web ci sarà un sistema di login da cui potranno accedere solo i docenti.

### 1.4 Analisi del dominio

Questa applicazione permette di controllare a distanza luci, tende e beamer delle aule delle scuole. Infatti il suo contesto principale di utilizzo sono proprio le scuole dato che è un sistema molto semplice e a basso prezzo che fa proprio a caso delle scuole. Infatti l'idea è di implementare e testare quest'applicazione inizialmente in una singola aula dopdichè se funziona bene si può implementarlo in tutte le aule della scuola. Prodotti simili esistono già ma non specifici per le aule del CPT, inoltre il nostro sistema va ad interagire direttamente con il server della scuola per controllare chi di quelli che fa il login è un docente e quindi chi di essi potrà accedere al pannello di controllo o no. Senza il nostro prodotto gli utenti delle varie aule, docenti e allievi tribulano di continuo con i pulsanti delle luci che funzionano a caso.  

### 1.5 Analisi e specifica dei requisiti

Questi sono i requisiti iniziali, dato che all'inizio avevamo programmato di riuscire a fare tutto. Ma durante lo sviluppo del progetto ci siamo accorti che le cose da fare erano tante di cui la maggior parte tutte cose che non avevamo mai visto quindi abbiamo deciso di cambiare le priorità di alcuni requisiti.

#### Rquisiti iniziali

|		   |ID: REQ-01    |	    		                       |
|:---------|:-------------|:-----------------------------------|
|Nome:     |Domotizzazione dell'aula                          ||
|Priorità: |1                                                 ||
|Versione: |1.0                                               ||
|Note:     |                                                  ||
|          |Sotto requisiti                                    |
|001:      |Gestione luci, tende e beamer tramite un sito web ||

|		   |ID: REQ-02    |	    		             |
|:---------|:-------------|:-------------------------|
|Nome:     |Pagina di login                         ||
|Priorità: |1                                       ||
|Versione: |1.0                                     ||
|Note:     |                                        ||

|		   |ID: REQ-03    |	    		             |
|:---------|:-------------|:-------------------------|
|Nome:     |Pagina gestione aule                    ||
|Priorità: |1                                       ||
|Versione: |1.0                                     ||
|Note:     |                                        ||
|          |Sotto requisiti                          | 
|001:      |Modificare lo stato delle luci          ||
|002:      |Modificare lo stato delle tende         ||
|003:      |Modificare lo stato del beamer          ||

|		   |ID: REQ-04    |	    		             |
|:---------|:-------------|:-------------------------|
|Nome:     |Server in Tomcat                        ||
|Priorità: |1                                       ||
|Versione: |1.0                                     ||
|Note:     |                                        ||
|          |Sotto requisiti                          | 
|001:      |Gestione della parte web                ||

|		   |ID: REQ-05    |	    		                      |
|:---------|:-------------|:----------------------------------|
|Nome:     |JDBC                                             ||
|Priorità: |1                                                ||
|Versione: |1.0                                              ||
|Note:     |                                                 ||
|          |Sotto requisiti                                   | 
|001:      |Controllare gli account sul database della scuola||

|		   |ID: REQ-06    |	    		                      |
|:---------|:-------------|:----------------------------------|
|Nome:     |LDAP                                             ||
|Priorità: |1                                                ||
|Versione: |1.0                                              ||
|Note:     |                                                 ||
|          |Sotto requisiti                                   | 
|001:      |Connetersi con java al database domotics         ||

|		   |ID: REQ-07    |	    		                      |
|:---------|:-------------|:----------------------------------|
|Nome:     |Arduino Connection Controller Client             ||
|Priorità: |1                                                ||
|Versione: |1.0                                              ||
|Note:     |                                                 ||

|		   |ID: REQ-08    |	    		                      |
|:---------|:-------------|:----------------------------------|
|Nome:     |Arduino Connection Controller Server             ||
|Priorità: |1                                                ||
|Versione: |1.0                                              ||
|Note:     |                                                 ||

|		   |ID: REQ-09    |	    		                             |
|:---------|:-------------|:-----------------------------------------|
|Nome:     |Guide di utilizzo                                       ||
|Priorità: |2                                                       ||
|Versione: |1.0                                                     ||
|Note:     |                                                        ||
|          |Sotto requisiti                                          |
|001:      |Arduino yun                                             ||
|002:      |Server in Tomcat                                        ||

|		   |ID: REQ-10    |	    		               |
|:---------|:-------------|:---------------------------|
|Nome:     |Simulazione luci                          ||
|Priorità: |1                                         ||
|Versione: |1.0                                       ||
|Note:     |                                          ||
|          |Sotto requisiti                            |
|001:      |Controllo dei led tramite l'arduino       ||

|		   |ID: REQ-11    |	                                      |
|:---------|:-------------|:--------------------------------------|
|Nome:     |Simulazione tende                                    ||
|Priorità: |1                                                    ||
|Versione: |1.0                                                  ||
|Note:     |                                                     ||
|          |Sotto requisiti                                       |
|001:      |Controllo dei motori tramite l'arduino               ||

## Arrivati 1 mese dalla fine del progetto ci siamo accorti che non c'era abbastanza tempo per l'implementazione fisica dei moduli così abbiamo deciso di metterli in priorità 3 e di cercare di concentrarci sul resto.

|		   |ID: REQ-12    |	    		             |
|:---------|:-------------|:-------------------------|
|Nome:     |Server in Python                        ||
|Priorità: |1                                       ||
|Versione: |1.0                                     ||
|Note:     |                                        ||
|          |Sotto requisiti                          | 
|001:      |Gestione dell'automatizzazione          ||

|		   |ID: REQ-13    |	    		             |
|:---------|:-------------|:--------------------------|
|Nome:     |Modulo luci                              ||
|Priorità: |3                                        ||
|Versione: |1.0                                      ||
|Note:     |                                         ||
|          |Sotto requisiti                           |
|001:      |Implementazione modulo fisico delle luci ||

|		   |ID: REQ-14    |      		               |
|:---------|:-------------|:---------------------------|
|Nome:     |Modulo tende                              ||
|Priorità: |3                                         ||
|Versione: |1.0                                       ||
|Note:     |                                          ||
|          |Sotto requisiti                            |
|001:      |Implementazione modulo fisico delle tende ||

|		   |ID: REQ-15    |	    		             |
|:---------|:-------------|:-------------------------|
|Nome:     |Modulo beamer                           ||
|Priorità: |3                                       ||
|Versione: |1.0                                     ||
|Note:     |                                        ||
|          |Sotto requisiti                          |
|001:      |Implementazione modulo fisico del beamer||

###  1.6 Pianificazione

![Gantt](img/Gantt/Gantt.jpg)

Il progetto ci è stato commissionato il 13 Febbraio 2019 re programmiamo di completarlo il 17 Maggio 2019.
Questo è il gantt che rappresenta la nostra pianificazione iniziale. È strutturato in modo tale che la documentazione viene portata a pari passo con tutto il progetto, poi dal 15 Febbraio al 29 Marzo arriva la progettazione dove viene fatta la stesura del gantt, viene fatta l'analisi del dominio, dei requisiti, e si inizia a fare la progettazione di come sarà l'intera rete, come sarà il design del frontend, il design del backend e come sarà lo schema dell'arduino. Dopo la progettazione incomincia la parte di implementazione che va dal 13 Febbraio al 8 Maggio infatti essendo un gruppo da tre quando qualcuno finirà la progettazione qualcuno potrà già iniziare con l'implementazione dei vari moduli. Nel gantt viene mostrato come inizieremo ad implementare prima il frontend, ci occuperemo dell'arduino ed infine ci concentreremo sull'implementazione del backend. Dopo l'implementazione ci sarà l'integrazione di tutti i moduli dal frontend che dovrà comunicare con il backend e con l'arduino. Dopodiché verranno effettuati i test ed infine viene fatta la presentazione.

### 1.7 Analisi dei mezzi

#### 1.7.1 Software

*   JetBrains WebStorm 2018.3.5<br>
*   JetBrains CLion 2018.3.4<br>
*   IntelliJ IDEA 2018.3.4<br>
*   Visual Studio Code<br>
*   Sublime Text 3<br>
*   StarUML<br>
*   Oracle VM VirtualBox<br>
*   Fritzing.exe<br>
*   Arduino<br>
*   Atom<br>
*   GitHub Desktop<br>
*   NetBeans IDE 8.2


#### 1.7.2 Hardware
*   Mattia Ruberto:
    Asus ROG Intel(R) Core(TM) i7-7700HQ CPU 2.80GHz RAM 16GB 

*   Giulio Bosco:
    Mac Book Pro 2018 i7 CPU 3.1GHz RAM 16GB

*   Paolo Gübli
    HP Omen 17 i7-6700HQ CPU 2.6GHz RAM 16GB

*   Arduino Yun 7300


## 2 Progettazione

### 2.1 Architettura progetto

![fullStructure](img/full_system_architetture.png)

Questo è lo schema che rappresenta il nostro progetto.
Il nostro progetto è strutturato nel seguente modo:
Nella parte fisica ci saranno i vari componenti dell'aula, come le luci, il beamer, le tende e i vari sensori.
Nella parte Control l'arduino viene controllato tramite l'Arduino Connection Controller Server e Client che gli permettono di comunicare con il sito web, da cui si può accedere tramite il login, una volta che si accede al sito porta l'utente alla dashboard iniziale dove è possibile vedere tutte le aule presenti e selezionare quella che si vuole gestire.
Il sito web è caricato sul web server in Tomcat mentre domotics server si occupa di auto configurare gli arduino presenti sulla rete, di trovarli e di memorizzare porta, indirizzo e chiave che poi salverà sul nostro database dove salviamo le seguenti informazioni.
LDAP connector invece gestisce il login, infatti ogni volta che verrà effettuato lui andrà a confrontare le credenziali con quelle del server della scuola per controllare che l'utente che sta cercando di accedere al pannello di controllo sia un account di un docente.

### 2.2 Design dell'interfaccia di login

![Login](img/sito/Login.JPG)

Questo è l'architettura iniziale del login del sito web, l'interfaccia è molto semplice infatti ci sar&agrave; un form di login che richieder&agrave; nome untente e password.

### 2.3 Design della dashboard del sito web

![Login](img/sito/Portal.JPG)

Questo &egrave; il design del sito web dopo che si ha fatto il login e che le credenziali sono state convalidate e confermate. Il sito porta in questa pagina dove si posssono visualizzare le varie aule con la possibilità di vedere la temperatura e accendere/spengenere le luci.

### 2.4 Architettura Database

![DataBase](img/db/DbDiagram.png)

Questo è il design del database, il database è formato da sette tabelle. La tabella room rappresenta le aule di cui viene salvato il loro identificatore, per ogni aula viene associato un arduino di cui viene memorizzato l'id, l'indirizzo ip, la password e la chiave per il client. Per ogni arduino si gestiscono i bottoni delle luci, di cui vengono memorizzati i suoi pin e le luci. Ogni arduino gestisce le luci, il beamer, le tende e i sensori che ci sono all'interno dell'aula di cui vengono memorizzati i pin.
In questo modo grazia alla chiave che ogni arduino ha, il server riesce a riconoscerli e identificarli per poi ricavare lo stato di tutti i suoi moduli, quindi luci, tende, beamer e sensori andando a ricercare le varie informazione nel database e riesce.

### 2.5 Architettura LDAP connector

![LDAP](img/ldap/uml.png)

La classe LdapConnector viene utilizzata nel login, infatti quando l'utente si loggerà le credenziali che mette vengono prese e questa classe va a confrontarle con le credenziali del database della scuola dove vede se l'utente è un docente e quindi ha i permessi per accederci o è un allievo e quindi non ha i permessi. LDAP permette di mantenere anche una certa sicurezza essendo che va a leggere i dati i modo criptato.
Nella classe ci saranno i seguenti attributi statici: la porta di default del server, la chiave di autentificazione, e una variabile che rappresenta il contesto iniziale del LDAP. Poi nelle variabili domain viene salvato il dominio del server LDAP, nella variabile port la porta del server se è diversa da quella di dafault, la variabile base rappresenta il livello del server nelle unità organizzative dove andare a controllare le credenziali e security rappresenta il tipo di sicurezza che viene utilizzata per connettersi. Nella classe vengono implementati poi tutti i vari get e set per settare o ritornare i valori delle variabili, ci saranno tre costruttori, uno in cui gli viene passato il dominio, la porta, l'unità organizzativa e il tipo di sicurezza, uno in cui non gli viene passato il tipo di sicurezza e nel terzo gli viene passato solo il dominio e l'unità organizzativa. Il metodo getEnvironment ritorna l'ambiente hashtable della connessione, getConnectionString ritorna la stringa di connessione, getDN ritorna una stringa con le credenziali e l'unita organizzativa da inviare nel metodo getEnvironment per creare la connessione e getDirContext che ritorna se l'utente ha i permessi o no.

### 2.6 Architettura Arduino Yun

![SchemaArduino](img/arduino/SchemaArduino.PNG)

Questo è il design dello schema dell'arduino, come si può notare l'arduino YUN e questo particolare schema rappresenta una simulazione di ciò che poi si dovrà implementare fisicamente, infatti i motori delle tende sono stati sostituiti con dei servomotor che rappresenteranno poi i motori che verranno utilizzati per muovere le tende. Le luci invece vengono controllate tramite dei relays che permettono di collegarsi alle luci. Per le simulazioni si può sostituire i relays con dei LED. Gli interruttori delle luci delle aule vengono simulati con dei bottoni in pull-down. Nello schema c'è anche il sensore di temperatura e il sensore di luce che possono essere usati per dare dati in più sull'aula.

### 2.7 Arduino Connection Controller Client

![Login](img/ACC_Client/ACC_Client_UML.png)

Queste classi permettono all'arduino di connettersi al server dall'arduino e di ricavare le informazioni necessarie per il server per conoscere lo stato dell'arduino.

### 2.8 Arduino Connection Controller Server

## 3 Implementazione

### 3.1 Login del sito web

### 3.2 Dashboard del sito web

### 3.3 Database

Per realizzare il database abbiamo utilizzato MySQL.
Prima di tutto bisogna creare il database tramite il seguente comando.
```SQL
/* create the database */
CREATE DATABASE domotics;
```
In questo pezzo di codice creiamo la tabella che rappresenta l'aula che avrà un singolo attributo che rappresenta il nome dell'aula.
```SQL
/* create the room table */
CREATE TABLE domotics.room (
    name VARCHAR(255) PRIMARY KEY
);
```
Dopo aver creato l'aula creiamo la tabella che rappresenta l'arduino e dovra avere al suo interno l'id del client, l'indirizzo ip, la password della root, la chiave del client e l'aula i cui è posizionato.
```SQL
/* create the arduino table */
CREATE TABLE domotics.arduino (
	client_id VARCHAR (255) PRIMARY KEY,
	ip VARCHAR (255),
  root_password VARCHAR (255),
	client_key VARCHAR (255),
	room VARCHAR (255),

	FOREIGN KEY (room) REFERENCES domotics.room(name)
);
```
Adesso bisogna creare le tabelle che rappresentano i moduli che l'arduino andrà a controllare.
I moduli dovranno avere come attributi il numero del pin, l'arduino da cui vengono controllati e il loro stato.
```SQL
/* create the light table */
CREATE TABLE domotics.light (
    pin VARCHAR (255),
	arduino VARCHAR (255),
	status INT (1),
	PRIMARY KEY (pin, arduino),
	FOREIGN KEY (arduino) REFERENCES domotics.arduino(client_id)
);
```

### 3.4 Lightweight Directory Access Protocol (LDAP)
Per controllare se l'utente che sta provando a fare il login sia veramente un docente e quindi con i permessi per accedere si usa LDAP, che va sul database della scuola e controlla se le credenziali corrispondono a un docente o no.

Per fare questo serve server una stringa di connessione che dice a LDAP dove andare a connettersi. Che deve contenere il domimio e la porta del server ADDS.
```java
    private String getConnectionString() {
        return "ldap://" + getDomain() + ":" + getPort();
    }
```
Questo metodo viene utilizzato per creare e poi ritornare DN, è simile a un percorso assoluto solo che invece di scendere l'albero da sinistra scende a destra.
Ecco un esempio di DN:
CN=john.doe,OU=People,DC=example,DC=com
CN è il nome utente, OU è l'unita organizzativa a cui deve puntare (che possono essere più di una) mentre il primo DC rappresenta le componenti del dominio.
```java
    private String getDn(String username) {
        return "CN=" + username + "," + getBase();
    }
```
Il metodo sottostante si occupa di creare una Hashtable che contiene tutti i parametri che poi verranno inviati.
I parametri che andranno inviati sono:
DEFAULT_INITIAL_CONTEXT_FACTORY, Connessione iniziale predefinita del contesto iniziale di fabbrica.
getConnectionString(), stringa di connessione.
getDn(username), percorso a cui deve puntare.
password, password con cui si è tentato di accedere e che deve essere controllata.
```java
    private Hashtable<String, String> getEnvironment(String username, String password) {
        Hashtable<String, String> environment = new Hashtable<String, String>();

        environment.put(Context.INITIAL_CONTEXT_FACTORY, DEFAULT_INITIAL_CONTEXT_FACTORY);
        environment.put(Context.PROVIDER_URL, getConnectionString());
        environment.put(Context.SECURITY_AUTHENTICATION, getSecurity());
        environment.put(Context.SECURITY_PRINCIPAL, getDn(username));
        environment.put(Context.SECURITY_CREDENTIALS, password);

        return environment;
    }
```
Quest'ultimo metodo invece utilizza l'Hashtable per collegarsi e controllare se l'utente è presente all'interno dell'unità organizzativa a cui gli è stato detto di andare a controllare.
Se l'autenticazione è valida continua altrimenti richiama un eccezione.
```java
public DirContext getDirContext(String username, String password) throws NamingException {
        return new InitialDirContext(getEnvironment(username, password));
    }
```
### 3.5 Implementazione Java DataBase Connectivity (JDBC)
Java DataBase Connectivity viene utilizzato per connettersi tramite java al database e ricavarne le informazione che si vogliono sapere.<br>
La prima cosa da fare è scaricare i driver corretti per MySql, quindi andando sul sito: https://dev.mysql.com/downloads/connector/j/
selezionare il proprio sistema operativo e scaricare i driver della stessa versione di MySQL sul proprio computer (Consigliata 8.0.15).

Dopodichè bisogna realizzare una connection string che permette di connettersi al database.
<br>
Nel seguente pezzo di codice realizziamo la stringa di connessione, la stringa è composta da una parte iniziale che rappresenta il protocollo di rete per arrivare a MySQL, poi bisogna passargli l'host, la porta e il nome del database e in più per evitare problemi con il driver è consigliabile anche aggiungere l'orario della propria zona geografica.
```java
String connectionString = "jdbc:mysql://" + host + ":" + port + "/" + database + "?";
        connectionString += TIMEZONE_UTC;
```
<br>
Quest'altro metodo serve per dire a DriverManager quando dovrà instaurare la connessione quali driver deve utilizzare.<br>

```java
Class.forName("com.mysql.cj.jdbc.Driver");
```
<br>
Per creare la connessione DriverManager ha bisogno della connectionstring, dell'username e della password. Infine viene ritornata la connessione tramite DriverManager.

```java
DriverManager.getConnection(connectionString, username, password);
```
<br>
Metodo che crea un istruzione dal collegamento al database, che verrà poi utilizzato per inviare le query al database.

```java
this.statement = this.connection.createStatement();
```
<br>
Quest'altro metodo invece chiude l'istruzione dal collegamento al database.

```java
this.statement.close();
```

Questo metodo serve per fare delle query sul database, gli viene passata la stringa contenente la query, viene creato il collegamento tramite il metodo spiegato in precedenza ed infine tramite executeQuery viene inviata la richiesta al database che verrà poi ritornata del metodo sottoforma di stringa.

```java
public ResultSet query(String query) throws SQLException {

    this.createStatement();

    return this.statement.executeQuery(query);
}
```

Nel caso dov'essero esserci errori con i driver provare a seguire i seguenti procedimenti:<br>
*   Se vi dice che "Loading class com.mysql.jdbc.Driver. This is deprecated." è perché dalla nuova     versione la stringa dentro Class.forName() contiene cj invece nelle vecchie versione non lo contiene.
*   Se vi dice che la zona oraria non è valida basta scrivere dentro a MySQl Workbench indicando a quale fuso orario apparteneteWS:
    ```Sql
    SET @@global.time_zone = '+01:00';
    SET @@session.time_zone = '+01:00';
    ```


### Arduino Connection Controller Client

### Arduino Connection Controller Server

## 4 test

### 4.1 Protocollo di test

|Test Case      | TC-001                               |
|---------------|--------------------------------------|
|**Nome**       |                                      |
|**Riferimento**|                                      |
|**Descrizione**|                                      |
|**Prerequisiti**|                                     |
|**Procedura**     |                                   |
|**Risultati attesi** |                                |