# Domotics | Diario di lavoro - 13.02.2019

##### Ruberto Mattia, Paolo Guebeli, Bosco Giulio

### Canobbio, 13.02.2019

## Lavori svolti

### Giulio

Rigurardato e controllato il design del modulo ACC con Mussi.

Cambiato la password dell'arduino yun, per farlo bisogna caricare il seguente sketch sull'Arduino.
Dopo di che aprire la porta seriale e connettersi ed utilizzzare i comandi di UNIX per cambiare la
password, quindi `passwd`.

```cpp
long linuxBaud = 250000;

void setup() {
  SERIAL_PORT_USBVIRTUAL.begin(115200);  // open serial connection via USB-Serial
  SERIAL_PORT_HARDWARE.begin(linuxBaud); // open serial connection to Linux
}

boolean commandMode = false;

void loop() {
  // copy from USB-CDC to UART
  int c = SERIAL_PORT_USBVIRTUAL.read();    // read from USB-CDC
  if (c != -1) {                            // got anything?
    if (commandMode == false) {             // if we aren't in command mode...
      if (c == '~') {                       //    Tilde '~' key pressed?
        commandMode = true;                 //       enter in command mode
      } else {
        SERIAL_PORT_HARDWARE.write(c);      //    otherwise write char to UART
      }
    } else {                                // if we are in command mode...
      if (c == '0') {                       //     '0' key pressed?
        SERIAL_PORT_HARDWARE.begin(57600);  //        set speed to 57600
        SERIAL_PORT_USBVIRTUAL.println("Speed set to 57600");
      } else if (c == '1') {                //     '1' key pressed?
        SERIAL_PORT_HARDWARE.begin(115200); //        set speed to 115200
        SERIAL_PORT_USBVIRTUAL.println("Speed set to 115200");
      } else if (c == '2') {                //     '2' key pressed?
        SERIAL_PORT_HARDWARE.begin(250000); //        set speed to 250000
        SERIAL_PORT_USBVIRTUAL.println("Speed set to 250000");
      } else if (c == '3') {                //     '3' key pressed?
        SERIAL_PORT_HARDWARE.begin(500000); //        set speed to 500000
        SERIAL_PORT_USBVIRTUAL.println("Speed set to 500000");
      } else if (c == '~') {                //     '~` key pressed?
        SERIAL_PORT_HARDWARE.write((uint8_t *)"\xff\0\0\x05XXXXX\x7f\xf9", 11); // send "bridge shutdown" command
        SERIAL_PORT_USBVIRTUAL.println("Sending bridge's shutdown command");
      } else {                              //     any other key pressed?
        SERIAL_PORT_HARDWARE.write('~');    //        write '~' to UART
        SERIAL_PORT_HARDWARE.write(c);      //        write char to UART
      }
      commandMode = false;                  //     in all cases exit from command mode
    }
  }

  // copy from UART to USB-CDC
  c = SERIAL_PORT_HARDWARE.read();          // read from UART
  if (c != -1) {                            // got anything?
    SERIAL_PORT_USBVIRTUAL.write(c);        //    write to USB-CDC
  }
}
```

[https://www.arduino.cc/en/Guide/ArduinoYun](https://www.arduino.cc/en/Guide/ArduinoYun)  
[http://forum.arduino.cc/index.php?topic=221431.msg1610137#msg1610137](http://forum.arduino.cc/index.php?topic=221431.msg1610137#msg1610137)  
[https://www.arduino.cc/en/Tutorial/Bridge](https://www.arduino.cc/en/Tutorial/Bridge)  

Dopo di che ho cercato di capire come funziona l'arduino yun. Il quale &egrave; composto
principalmente di due componenti, un arduino con la scheda ATmega 32u4, connessa alla porta microUSB
ed ai PIN.  
'altro canto c'&egrave; un chip Linino AR 9331 che esegue Linux OpenWRT che &egrave; una
distro per sistemi embedded, il chip Linino &egrave; collegato alla porta USB tipo A, allo slot per
la scheda microSD, all'interffaccia Wi-Fi ed alla porta Ethernet.  
I due componenti sono collegati tramite un bridge seriale.

![Arduino Yun Logincal Schema](../doc/img/arduino/BridgeBlockDiag.png)

Trovato il programma bridge e testato con il pin 13 (on board), eseguendo le richieste via browser
funziona, si accende e si spegne.

```
// richiesta per accedere il led sull'arduino
http://10.20.4.111/cgi-bin/luci/arduino/digital/13/1
// richiesta per spegnere il led sull'arduino
http://10.20.4.111/cgi-bin/luci/arduino/digital/13/0
```

[https://forum.arduino.cc/index.php?topic=231399.0](https://forum.arduino.cc/index.php?topic=231399.0)  
[http://arduinoindiarobomart.blogspot.com/2015/11/in-this-tutorial-we-are-learning-to-how.html](http://arduinoindiarobomart.blogspot.com/2015/11/in-this-tutorial-we-are-learning-to-how.html)  

Creato programma "blink" (ino/blink) per arduino yun, sia la parte di arduino che la parte di linux
in python.

parte arduino:

```cpp
#include <Bridge.h>
#include <stdio.h>

/**
 * Arduino blink on pin 13 sketch.
 *
 * @author giuliobosco (giuliobva@gmail.com)
 * @version 1.0 (2019-03-20 - 2019-03-20)
 */

// Here we will hold the values coming from Python via Bridge
char D13value[2];

void setup() {
  // Zero out the memory we're using for the Bridge
  memset(D13value, 0, 2);

  // Initialize digital pins 12 and 13 as output
  pinMode(13, OUTPUT);

  // Start using the Bridge
  Bridge.begin();
}

void loop() {
  // Write current value of D13 to the pin (basically turning it on or off)
  Bridge.get("D13", D13value, 2);
  int D13int = atoi(D13value);
  digitalWrite(13, D13int);

  // An arbitrary amount of delay to make the whole thing more reliable
  delay(10);
}
```

parte python:

```py
#include <Bridge.h>
#include <stdio.h>

# Arduino blink on pin 13 sketch
#
# @author giuliobosco (giuliobva@gmail.com)
# @version 1.0 (2019-03-20 - 2019-03-20)

import sys
sys.path.insert(0, '/usr/lib/python2.7/bridge')

from time import sleep
from bridgeclient import BridgeClient as bridgeclient

value = bridgeclient()

for idx in range(0, 100):
    value.put('D13','1')
    sleep(0.1)
    value.put('D13','0')
    sleep(0.1)

print("I hope you enjoyed the light show\n")
```

### Mattia

### Paolo


##  Problemi riscontrati e soluzioni adottate


##  Punto della situazione rispetto alla pianificazione
In linea con la pianificazione.


## Programma di massima per la prossima giornata di lavoro
Informarsi e capire cosa e come si devono fare le varie cose.
